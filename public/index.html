<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Painel de For√ßa Cripto</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://cdn.datatables.net/1.13.4/css/jquery.dataTables.min.css">
  <link rel="stylesheet" href="https://cdn.datatables.net/buttons/2.4.1/css/buttons.dataTables.min.css">
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f3f3f3;
      margin: 0;
      padding: 20px;
    }
    #loginBox {
      background: #fff;
      padding: 30px;
      max-width: 400px;
      margin: 40px auto;
      border-radius: 8px;
      text-align: center;
    }
    #loginBox input {
      width: 80%;
      padding: 10px;
    }
    #painelInterno {
      display: none;
      max-width: 1200px;
      margin: auto;
    }
    select {
      margin: 10px 10px 10px 0;
      padding: 6px;
    }
  </style>
</head>
<body>

<div id="loginBox">
  <h2>üîê Acesso ao Painel</h2>
  <input type="email" id="email" placeholder="Digite seu e-mail autorizado" />
  <br /><br />
  <button id="carregar">Entrar</button>
  <p id="erro" style="color: red;"></p>
</div>

<div id="painelInterno">
  <h1>Painel de For√ßa Di√°ria</h1>

  <label for="tipo">Tipo:</label>
  <select id="tipo">
    <option value="">Todos</option>
    <option value="AltaHoje">AltaHoje</option>
    <option value="NeutroHoje">NeutroHoje</option>
    <option value="ResistentesHoje">ResistentesHoje</option>
  </select>

  <label for="filtroRSI">RSI (1D):</label>
  <select id="filtroRSI">
    <option value="">Todos</option>
    <option value="70+">RSI ‚â• 70</option>
    <option value="60-69">RSI 60‚Äì69</option>
    <option value="40-59">RSI 40‚Äì59</option>
    <option value="sub40">RSI ‚â§ 40</option>
  </select>

  <input type="text" id="pesquisa" placeholder="üîç Buscar..." />
  <br><br>

  <table id="tabela" class="display nowrap" style="width:100%">
    <thead>
      <tr>
        <th>Ranking</th>
        <th>S√≠mbolo</th>
        <th>Link</th>
        <th>RSI (1D)</th>
        <th>Varia√ß√£o 1D (%)</th>
        <th>Volume (24h)</th>
        <th>Holders</th>
        <th>Tipo</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
</div><script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>
<script src="https://cdn.datatables.net/1.13.4/js/jquery.dataTables.min.js"></script>
<script src="https://cdn.datatables.net/buttons/2.4.1/js/dataTables.buttons.min.js"></script>
<script src="https://cdn.datatables.net/buttons/2.4.1/js/buttons.html5.min.js"></script>
<script src="https://cdn.datatables.net/buttons/2.4.1/js/buttons.print.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.2.7/pdfmake.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.2.7/vfs_fonts.min.js"></script>

<script>
  let tabela;

  document.getElementById("carregar").addEventListener("click", () => {
    const email = document.getElementById("email").value.trim();
    if (!email) return alert("Informe seu e-mail.");

    const url = "https://script.google.com/macros/s/AKfycbwkBYvFnRrBUnj7iPImgWkGDfJwdJmlHadDHsLU7-KmXI7hsEW68kZ_4QsUhJqjH6O-/exec?email=" + encodeURIComponent(email);

    fetch(url)
      .then(res => res.json())
      .then(dados => {
        if (dados.erro) {
          document.getElementById("erro").textContent = dados.erro;
          return;
        }

        document.getElementById("loginBox").style.display = "none";
        document.getElementById("painelInterno").style.display = "block";

        const todas = [];
        for (const tipo in dados) {
          dados[tipo].forEach(row => todas.push([...row, tipo]));
        }

        tabela = $('#tabela').DataTable({
          data: todas,
          columns: [
            null,
            null,
            {
              render: d => `<a href="${d}" target="_blank">üîó</a>`
            },
            null,
            null,
            null,
            null,
            null
          ],
          dom: 'Bfrtip',
          buttons: [
            {
              extend: 'csv',
              text: 'üìä Exportar CSV',
              filename: 'Painel_Forca_' + new Date().toISOString().slice(0, 10)
            },
            {
              extend: 'pdfHtml5',
              text: 'üñ®Ô∏è Exportar PDF',
              filename: 'Painel_Forca_' + new Date().toISOString().slice(0, 10),
              orientation: 'landscape',
              pageSize: 'A4'
            }
          ],
          createdRow: function (row, data) {
            const valor = parseFloat(data[4]);
            if (valor >= 20) $(row).find('td:eq(4)').css('background', '#00FF00');
            else if (valor >= 10) $(row).find('td:eq(4)').css('background', '#90EE90');
            else if (valor > 0) $(row).find('td:eq(4)').css('background', '#D0FFD0');
            else if (valor < 0) $(row).find('td:eq(4)').css('background', '#FFB6B6');
          }
        });

        // Filtro tipo
        $("#tipo").on("change", function () {
          tabela.column(7).search(this.value).draw();
        });

        // Filtro texto
        $("#pesquisa").on("keyup", function () {
          tabela.search(this.value).draw();
        });

        // Filtro RSI
        $("#filtroRSI").on("change", function () {
          const faixa = this.value;
          tabela.rows().every(function () {
            const rsi = parseFloat(this.data()[3]);
            let mostrar = true;
            if (faixa === "70+") mostrar = rsi >= 70;
            else if (faixa === "60-69") mostrar = rsi >= 60 && rsi < 70;
            else if (faixa === "40-59") mostrar = rsi >= 40 && rsi < 60;
            else if (faixa === "sub40") mostrar = rsi < 40;
            this.visible(faixa === "" ? true : mostrar);
          });
        });
      });
  });
</script>
</body>
</html>
