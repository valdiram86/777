<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>On-Chain SetValues</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://cdn.datatables.net/1.13.4/css/jquery.dataTables.min.css" />
  <link rel="stylesheet" href="https://cdn.datatables.net/buttons/2.4.1/css/buttons.dataTables.min.css" />
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0; padding: 20px;
      background: #f5f5f5;
    }
    h1 {
      text-align: center;
      margin-bottom: 30px;
    }
    #loginBox {
      background: #fff;
      padding: 30px;
      max-width: 400px;
      margin: 50px auto;
      border-radius: 10px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }
    #painelInterno {
      display: none;
      max-width: 1200px;
      margin: auto;
    }
    table {
      width: 100%;
    }
  </style>
</head>
<body>
  <h1>On-Chain SetValues</h1>

  <div id="loginBox">
    <label>Digite seu e-mail para acessar:</label><br><br>
    <input type="email" id="email" placeholder="email@example.com" style="width: 100%; padding: 8px;" />
    <br><br>
    <button onclick="acessarPainel()">Entrar</button>
  </div>

  <div id="painelInterno">
    <table id="tabela" class="display"></table>
  </div>

  <script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>
  <script src="https://cdn.datatables.net/1.13.4/js/jquery.dataTables.min.js"></script>
  <script src="https://cdn.datatables.net/buttons/2.4.1/js/dataTables.buttons.min.js"></script>
  <script src="https://cdn.datatables.net/buttons/2.4.1/js/buttons.html5.min.js"></script>
  <script src="https://cdn.datatables.net/buttons/2.4.1/js/buttons.print.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.2.7/pdfmake.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.2.7/vfs_fonts.js"></script>

  <script>
    function acessarPainel() {
      const email = document.getElementById("email").value.trim();
      if (!email) {
        alert("Digite um e-mail vÃ¡lido.");
        return;
      }

      const url = "https://script.google.com/macros/s/AKfycbxk8ZtWIGpWzCm8u1Kp7kT5uRXdCTg_oQtfW71XbzgZjc5VTB8IDLI4Y6BRJZtooyD6JQ/exec?email=" + encodeURIComponent(email);
      
      fetch(url)
        .then(res => res.json())
        .then(data => {
          document.getElementById("loginBox").style.display = "none";
          document.getElementById("painelInterno").style.display = "block";

          const colunas = [
            { title: "Ranking" },
            { title: "SÃ­mbolo" },
            { title: "Link", render: d => `<a href="${d}" target="_blank">ðŸ”—</a>` },
            { title: "RSI (1D)" },
            { title: "VariaÃ§Ã£o (%)" },
            { title: "Volume (USD)" },
            { title: "Market Cap (USD)" }
          ];

          const tabela = $('#tabela').DataTable({
            data: data,
            columns: colunas,
            destroy: true,
            dom: 'Bfrtip',
            buttons: [
              {
                extend: 'csv',
                text: 'ðŸ“Š Exportar CSV',
                filename: 'OnChainSetValues'
              },
              {
                extend: 'pdf',
                text: 'ðŸ“„ Exportar PDF',
                filename: 'OnChainSetValues',
                orientation: 'landscape',
                pageSize: 'A4'
              }
            ],
            createdRow: function(row, data) {
              const rsi = parseFloat(data[3]);
              const variacao = parseFloat(data[4]);

              if (!isNaN(rsi)) {
                if (rsi >= 72) row.cells[3].style.backgroundColor = "#00FF00";
                else if (rsi >= 58) row.cells[3].style.backgroundColor = "#90EE90";
              }

              if (!isNaN(variacao)) {
                if (variacao >= 20) row.cells[4].style.backgroundColor = "#006400";
                else if (variacao >= 10) row.cells[4].style.backgroundColor = "#228B22";
                else if (variacao >= 5) row.cells[4].style.backgroundColor = "#90EE90";
              }
            }
          });
        })
        .catch(err => {
          alert("Erro ao acessar os dados. Verifique se seu e-mail estÃ¡ autorizado.");
        });
    }
  </script>
</body>
</html>
