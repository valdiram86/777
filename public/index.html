<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>Painel de Força Diária</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="https://cdn.datatables.net/1.13.4/css/jquery.dataTables.min.css" />
  <link rel="stylesheet" href="https://cdn.datatables.net/buttons/2.4.1/css/buttons.dataTables.min.css" />
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #111;
      color: #fff;
      padding: 20px;
    }
    h1 {
      text-align: center;
    }
    #loginBox {
      max-width: 400px;
      margin: 100px auto;
      padding: 30px;
      background: #222;
      border-radius: 10px;
      text-align: center;
    }
    #painelInterno {
      display: none;
    }
    input[type="email"] {
      padding: 10px;
      width: 90%;
      font-size: 16px;
      margin-bottom: 10px;
    }
    button {
      padding: 10px 20px;
      font-size: 16px;
    }
    .filtro {
      margin-bottom: 20px;
      text-align: center;
    }
    .filtro select, .filtro input {
      font-size: 16px;
      padding: 5px;
      margin: 0 5px;
    }
    .green { background-color: #00ff00 !important; }
    .lightgreen { background-color: #90ee90 !important; }
    .softgreen { background-color: #d0ffd0 !important; }
    .red { background-color: #ffb6b6 !important; }
  </style>
</head>
<body>
  <div id="loginBox">
    <h2>🔒 Acesso ao Painel</h2>
    <input type="email" id="email" placeholder="Digite seu e-mail autorizado" />
    <br />
    <button onclick="acessarPainel()">Entrar</button>
    <p id="erroLogin" style="color: red;"></p>
  </div>

  <div id="painelInterno">
    <h1>Painel de Força Diária</h1>
    <div class="filtro">
      <label for="tipo">Tipo:</label>
      <select id="tipo">
        <option value="">Todos</option>
        <option value="AltaHoje">Alta</option>
        <option value="NeutroHoje">Neutro</option>
        <option value="ResistentesHoje">Resistência</option>
      </select>
      <input type="text" id="pesquisa" placeholder="🔍 Buscar por símbolo..." />
    </div>
    <table id="tabela" class="display nowrap" width="100%">
      <thead>
        <tr>
          <th>Ranking</th>
          <th>Símbolo</th>
          <th>Link</th>
          <th>RSI (1D)</th>
          <th>Variação 1D (%)</th>
          <th>Volume (24h)</th>
          <th>Holders</th>
          <th>Tipo</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

  <script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>
  <script src="https://cdn.datatables.net/1.13.4/js/jquery.dataTables.min.js"></script>
  <script src="https://cdn.datatables.net/buttons/2.4.1/js/dataTables.buttons.min.js"></script>
  <script src="https://cdn.datatables.net/buttons/2.4.1/js/buttons.html5.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
  <script>
    const endpoint = "https://script.google.com/macros/s/AKfycbxDRmGVs_VRuPifYVDn83jdgYgrDlK-xvXK4E-6tjLPFIHFl3ms0Ia3zoPrR6p_CB4/exec";
    let tabela;

    async function acessarPainel() {
      const email = document.getElementById("email").value.trim();
      if (!email) return;

      const url = `${endpoint}?email=${encodeURIComponent(email)}`;
      const resposta = await fetch(url);
      const dados = await resposta.json();

      if (dados.erro) {
        document.getElementById("erroLogin").innerText = dados.erro;
        return;
      }

      document.getElementById("loginBox").style.display = "none";
      document.getElementById("painelInterno").style.display = "block";
      carregarTabela(dados);
    }

    function carregarTabela(dados) {
      const combinado = [];

      ["AltaHoje", "NeutroHoje", "ResistentesHoje"].forEach(tipo => {
        if (dados[tipo]) {
          dados[tipo].forEach(row => combinado.push([...row, tipo]));
        }
      });

      tabela = $('#tabela').DataTable({
        data: combinado,
        columns: [
          { title: "Ranking" },
          { title: "Símbolo" },
          { title: "Link", render: d => `<a href="${d}" target="_blank">🔗</a>` },
          { title: "RSI (1D)" },
          { title: "Variação 1D (%)" },
          { title: "Volume (24h)" },
          { title: "Holders" },
          { title: "Tipo" }
        ],
        paging: false,
        dom: 'Bfrtip',
        buttons: [
          {
            extend: 'pdfHtml5',
            text: '📥 Exportar PDF',
            title: () => {
              const hoje = new Date();
              return "ForcaDiaria_" + hoje.toLocaleDateString("pt-BR");
            },
            orientation: 'landscape',
            pageSize: 'A4'
          },
          {
            extend: 'csv',
            text: '📊 Exportar CSV',
            title: "ForcaDiaria"
          }
        ],
        createdRow: function(row, data) {
          const variacao = parseFloat(data[4]);
          if (variacao >= 20) $(row).find('td:eq(4)').addClass('green');
          else if (variacao >= 10) $(row).find('td:eq(4)').addClass('lightgreen');
          else if (variacao > 0) $(row).find('td:eq(4)').addClass('softgreen');
          else if (variacao < 0) $(row).find('td:eq(4)').addClass('red');
        }
      });

      $('#pesquisa').on('keyup', function () {
        tabela.search(this.value).draw();
      });

      $('#tipo').on('change', function () {
        const tipo = this.value;
        tabela.column(7).search(tipo).draw();
      });
    }
  </script>
</body>
</html>
