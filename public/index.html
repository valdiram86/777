<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>On-Chain SetValues</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="https://cdn.datatables.net/1.13.4/css/jquery.dataTables.min.css" />
  <link rel="stylesheet" href="https://cdn.datatables.net/buttons/2.4.1/css/buttons.dataTables.min.css" />
  <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  <script src="https://cdn.datatables.net/1.13.4/js/jquery.dataTables.min.js"></script>
  <script src="https://cdn.datatables.net/buttons/2.4.1/js/dataTables.buttons.min.js"></script>
  <script src="https://cdn.datatables.net/buttons/2.4.1/js/buttons.html5.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.36/pdfmake.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.36/vfs_fonts.js"></script>
  <style>
    body { font-family: Arial, sans-serif; background: #f2f2f2; margin: 0; padding: 20px; }
    h1 { text-align: center; margin-bottom: 30px; }
    #painelInterno {
      max-width: 95%;
      margin: auto;
      background: #fff;
      padding: 20px;
      border-radius: 10px;
    }
    .filtros {
      margin-bottom: 20px;
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
    }
    .filtros input {
      padding: 8px;
      font-size: 14px;
      border: 1px solid #ccc;
      border-radius: 5px;
      width: 120px;
    }
    .filtros button {
      padding: 8px 16px;
      font-weight: bold;
      background: #222;
      color: #fff;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }
    .abas {
      margin-bottom: 20px;
      display: flex;
      gap: 10px;
      justify-content: center;
    }
    .abas button {
      padding: 8px 16px;
      font-weight: bold;
      border: none;
      background: #008080;
      color: #fff;
      border-radius: 5px;
      cursor: pointer;
    }
  </style>
</head>
<body>

  <h1>On-Chain SetValues</h1>

  <div id="painelInterno">
    <div class="abas">
      <button onclick="carregarDados('OndaDeAlta_5')">Onda 5%</button>
      <button onclick="carregarDados('OndaDeAlta_7_5')">Onda 7.5%</button>
      <button onclick="carregarDados('OndaDeAlta_10')">Onda 10%</button>
    </div>

    <div class="filtros">
      <input type="text" id="cripto1" placeholder="Cripto 1" />
      <input type="text" id="cripto2" placeholder="Cripto 2" />
      <input type="text" id="cripto3" placeholder="Cripto 3" />
      <input type="text" id="cripto4" placeholder="Cripto 4" />
      <input type="text" id="cripto5" placeholder="Cripto 5" />
      <button onclick="filtrar()">üîç Buscar</button>
    </div>

    <table id="tabela" class="display nowrap" style="width:100%">
      <thead></thead>
      <tbody></tbody>
    </table>
  </div>

<script>
  const email = "valdiram.lima.2013@gmail.com";
  let dadosOriginais = [];
  const apiBase = "https://script.google.com/macros/s/AKfycbxk8ZtWIGpWzCm8u1Kp7kT5uRXdCTg_oQtfW71XbzgZjc5VTB8IDLI4Y6BRJZtooyD6JQ/exec";

  // Carrega ao iniciar
  window.onload = () => {
    carregarDados("OndaDeAlta_5");
  };

  function carregarDados(aba) {
    const url = `${apiBase}?email=${encodeURIComponent(email)}&aba=${aba}`;
    fetch(url)
      .then(res => res.json())
      .then(dados => {
        dadosOriginais = dados;
        montarTabela(dados);
      })
      .catch(err => {
        alert("Erro ao carregar dados.");
        console.error(err);
      });
  }

  function montarTabela(dados) {
    if ($.fn.DataTable.isDataTable("#tabela")) {
      $('#tabela').DataTable().destroy();
    }

    const cabecalho = Object.keys(dados[0] || {});
    let html = "<tr>" + cabecalho.map(h => `<th>${h}</th>`).join("") + "</tr>";
    document.querySelector("#tabela thead").innerHTML = html;

    let linhas = dados.map(row => cabecalho.map(k => row[k]));
    $('#tabela').DataTable({
      data: linhas,
      columns: cabecalho.map(k => ({ title: k })),
      paging: false,
      scrollX: true,
      dom: 'Bfrtip',
      buttons: ['csv', 'pdf']
    });
  }

  function filtrar() {
    const termos = [
      document.getElementById("cripto1").value.trim().toLowerCase(),
      document.getElementById("cripto2").value.trim().toLowerCase(),
      document.getElementById("cripto3").value.trim().toLowerCase(),
      document.getElementById("cripto4").value.trim().toLowerCase(),
      document.getElementById("cripto5").value.trim().toLowerCase(),
    ].filter(x => x);

    if (!termos.length) {
      montarTabela(dadosOriginais);
      return;
    }

    const filtrados = dadosOriginais.filter(linha => {
      return termos.some(t => JSON.stringify(linha).toLowerCase().includes(t));
    });

    montarTabela(filtrados);
  }
</script>

</body>
</html>
