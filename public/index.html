<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>Painel Onda de Alta</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="https://cdn.datatables.net/1.13.4/css/jquery.dataTables.min.css" />
  <link rel="stylesheet" href="https://cdn.datatables.net/buttons/2.4.1/css/buttons.dataTables.min.css" />
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #fff;
      padding: 20px;
    }
    h1 {
      text-align: center;
    }
    #botoesAbas {
      text-align: center;
      margin-bottom: 20px;
    }
    #botoesAbas button {
      margin: 5px;
      padding: 8px 15px;
      font-weight: bold;
      cursor: pointer;
    }
    #filtrosExtras {
      max-width: 900px;
      margin: 20px auto;
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      justify-content: center;
    }
    #filtrosExtras input {
      padding: 6px;
      min-width: 80px;
      max-width: 130px;
    }
    .tabelaOnda {
      display: none;
      overflow-x: auto;
      width: 100%;
    }
    #tabelaWrapper {
      overflow-x: auto;
    }
  </style>
</head>
<body>
  <h1>Painel Onda de Alta</h1>

  <div id="botoesAbas">
    <button onclick="mostrarTabela('tabela5')">ðŸ”¥ Onda 5%</button>
    <button onclick="mostrarTabela('tabela75')">ðŸš€ Onda 7.5%</button>
    <button onclick="mostrarTabela('tabela10')">ðŸ’¥ Onda 10%</button>
  </div>

  <div id="filtrosExtras">
    <input type="text" id="buscarGeral" placeholder="ðŸ” Buscar geral" onkeyup="filtrarGeral()">
    <input type="text" id="cripto1" placeholder="Cripto 1" onkeyup="filtrarEspecificos()">
    <input type="text" id="cripto2" placeholder="Cripto 2" onkeyup="filtrarEspecificos()">
    <input type="text" id="cripto3" placeholder="Cripto 3" onkeyup="filtrarEspecificos()">
    <input type="text" id="cripto4" placeholder="Cripto 4" onkeyup="filtrarEspecificos()">
    <input type="text" id="cripto5" placeholder="Cripto 5" onkeyup="filtrarEspecificos()">
  </div>

  <div id="tabelaWrapper">
    <table id="tabela5" class="display tabelaOnda" style="width:100%"></table>
    <table id="tabela75" class="display tabelaOnda" style="width:100%"></table>
    <table id="tabela10" class="display tabelaOnda" style="width:100%"></table>
  </div>

  <script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>
  <script src="https://cdn.datatables.net/1.13.4/js/jquery.dataTables.min.js"></script>
  <script src="https://cdn.datatables.net/buttons/2.4.1/js/dataTables.buttons.min.js"></script>
  <script src="https://cdn.datatables.net/buttons/2.4.1/js/buttons.html5.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.36/pdfmake.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.36/vfs_fonts.js"></script>

  <script>
    let tabelas = {};
    let atual = 'tabela5';

    function mostrarTabela(id) {
      document.querySelectorAll(".tabelaOnda").forEach(t => t.style.display = "none");
      document.getElementById(id).style.display = "table";
      atual = id;
      tabelas[atual].draw();
    }

    function filtrarGeral() {
      const valor = document.getElementById("buscarGeral").value;
      tabelas[atual].search(valor).draw();
    }

    function filtrarEspecificos() {
      const termos = [
        document.getElementById("cripto1").value,
        document.getElementById("cripto2").value,
        document.getElementById("cripto3").value,
        document.getElementById("cripto4").value,
        document.getElementById("cripto5").value
      ].filter(Boolean).join("|");

      tabelas[atual].search(termos, true, false).draw();
    }

    function carregarTabela(id, dados) {
      tabelas[id] = $(`#${id}`).DataTable({
        data: dados,
        columns: [
          { title: "Ranking" },
          { title: "SÃ­mbolo" },
          { title: "Link", render: d => `<a href="${d}" target="_blank">Abrir</a>` },
          { title: "RSI (1D)" },
          { title: "VariaÃ§Ã£o 1D (%)" },
          { title: "Volume (24h)" },
          { title: "Market Cap" }
        ],
        paging: false,
        dom: 'Bfrtip',
        buttons: [
          {
            extend: 'pdfHtml5',
            text: 'ðŸ“„ Exportar PDF',
            title: 'Relatorio_' + new Date().toLocaleDateString(),
            orientation: 'landscape',
            pageSize: 'A4'
          }
        ]
      });
    }

    const baseURL = "https://script.google.com/macros/s/AKfycbzVm8b1e-Pk6u45NYj2NM6P_gsJbmIpZ1qA_SdzDUk4lt1BWvXX2jIyOB2kRKp5n1vUAg/exec";

    function carregarDados(aba, callback) {
      fetch(`${baseURL}?aba=${encodeURIComponent(aba)}`)
        .then(res => res.json())
        .then(data => callback(data))
        .catch(err => console.error("Erro ao buscar dados:", err));
    }

    carregarDados("OndaDeAlta_5", data => carregarTabela("tabela5", data));
    carregarDados("OndaDeAlta_7_5", data => carregarTabela("tabela75", data));
    carregarDados("OndaDeAlta_10", data => carregarTabela("tabela10", data));

    window.onload = () => mostrarTabela("tabela5");
  </script>
</body>
</html>
