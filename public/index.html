<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>Painel de For√ßa Di√°ria</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="https://cdn.datatables.net/1.13.4/css/jquery.dataTables.min.css" />
  <link rel="stylesheet" href="https://cdn.datatables.net/buttons/2.4.1/css/buttons.dataTables.min.css" />
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #111;
      color: #fff;
      padding: 20px;
    }
    h1 {
      text-align: center;
    }
    .filtro {
      margin-bottom: 20px;
      text-align: center;
    }
    .filtro select {
      font-size: 16px;
      padding: 5px;
    }
    .filtro input {
      font-size: 16px;
      padding: 5px;
      width: 300px;
    }
    .green { background-color: #00ff00 !important; }
    .lightgreen { background-color: #90ee90 !important; }
    .softgreen { background-color: #d0ffd0 !important; }
    .red { background-color: #ffb6b6 !important; }
  </style>
</head>
<body>
  <h1>Painel de For√ßa Di√°ria</h1>
  <div class="filtro">
    <label for="tipo">Tipo:</label>
    <select id="tipo">
      <option value="">Todos</option>
      <option value="AltaHoje">Alta</option>
      <option value="NeutroHoje">Neutro</option>
      <option value="ResistentesHoje">Resist√™ncia</option>
    </select>
    <input type="text" id="pesquisa" placeholder="üîç Buscar por s√≠mbolo..." />
  </div>
  <table id="tabela" class="display nowrap" width="100%">
    <thead>
      <tr>
        <th>Ranking</th>
        <th>S√≠mbolo</th>
        <th>Link</th>
        <th>RSI (1D)</th>
        <th>Varia√ß√£o 1D (%)</th>
        <th>Volume (24h)</th>
        <th>Holders</th>
        <th>Tipo</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>
  <script src="https://cdn.datatables.net/1.13.4/js/jquery.dataTables.min.js"></script>
  <script src="https://cdn.datatables.net/buttons/2.4.1/js/dataTables.buttons.min.js"></script>
  <script src="https://cdn.datatables.net/buttons/2.4.1/js/buttons.html5.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
  <script>
    const url = "https://script.google.com/macros/s/AKfycbxDRmGVs_VRuPifYVDn83jdgYgrDlK-xvXK4E-6tjLPFIHFl3ms0Ia3zoPrR6p_CB4/exec";
    let tabela;

    async function carregarDados() {
      const resposta = await fetch(url);
      const dados = await resposta.json();
      const combinado = [];

      ["AltaHoje", "NeutroHoje", "ResistentesHoje"].forEach(tipo => {
        if (dados[tipo]) {
          dados[tipo].forEach(row => combinado.push([...row, tipo]));
        }
      });

      tabela = $('#tabela').DataTable({
        data: combinado,
        columns: [
          { title: "Ranking" },
          { title: "S√≠mbolo" },
          { title: "Link", render: d => `<a href="${d}" target="_blank">üîó</a>` },
          { title: "RSI (1D)" },
          { title: "Varia√ß√£o 1D (%)" },
          { title: "Volume (24h)" },
          { title: "Holders" },
          { title: "Tipo" }
        ],
        paging: false,
        dom: 'Bfrtip',
        buttons: [
          {
            extend: 'pdfHtml5',
            text: 'üì• Exportar PDF',
            title: () => {
              const hoje = new Date();
              return "ForcaDiaria_" + hoje.toLocaleDateString("pt-BR");
            },
            orientation: 'landscape',
            pageSize: 'A4'
          },
          {
            extend: 'csv',
            text: 'üìä Exportar CSV',
            title: "ForcaDiaria"
          }
        ],
        createdRow: function(row, data) {
          const variacao = parseFloat(data[4]);
          if (variacao >= 20) $(row).find('td:eq(4)').addClass('green');
          else if (variacao >= 10) $(row).find('td:eq(4)').addClass('lightgreen');
          else if (variacao > 0) $(row).find('td:eq(4)').addClass('softgreen');
          else if (variacao < 0) $(row).find('td:eq(4)').addClass('red');
        }
      });

      $('#pesquisa').on('keyup', function () {
        tabela.search(this.value).draw();
      });

      $('#tipo').on('change', function () {
        const tipo = this.value;
        tabela.column(7).search(tipo).draw();
      });
    }

    carregarDados();
  </script>
</body>
</html>
