<!DOCTYPE html>
<html>
<head>
  <title>Painel RSI – On-Chain SetValues</title>
  <meta charset="UTF-8">
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #111;
      color: #fff;
      padding: 20px;
    }
    input, button {
      padding: 10px;
      font-size: 16px;
    }
    button {
      margin: 5px;
      background-color: #00b894;
      color: white;
      border: none;
      cursor: pointer;
    }
    #painel { display: none; margin-top: 20px; }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
    }
    th, td {
      padding: 8px;
      border: 1px solid #333;
      text-align: center;
    }
    th { background-color: #222; }
    a { color: #00f7ff; text-decoration: none; }
  </style>
</head>
<body>
  <h2>Painel RSI – Criptomoedas em Alta</h2>

  <div id="login">
    <p>Digite seu e-mail autorizado:</p>
    <input type="email" id="email" placeholder="exemplo@email.com">
    <button onclick="verificarEmail()">Entrar</button>
    <p id="mensagem"></p>
  </div>

  <div id="painel">
    <div>
      <button onclick="carregarTabela('TopMoedas1D')">TopMoedas1D</button>
      <button onclick="carregarTabela('OndaDeAlta_5')">OndaDeAlta_5</button>
      <button onclick="carregarTabela('OndaDeAlta_7_5')">OndaDeAlta_7_5</button>
      <button onclick="carregarTabela('OndaDeAlta_10')">OndaDeAlta_10</button>
      <button onclick="exportarCSV()">Exportar CSV</button>
    </div>

    <h3 id="tituloAba">Tabela</h3>
    <table>
      <thead id="cabecalho"></thead>
      <tbody id="dados"></tbody>
    </table>
  </div>

  <script>
    const URL_BASE = "https://script.google.com/macros/s/AKfycbxk8ZtWIGpWzCm8u1Kp7kT5uRXdCTg_oQtfW71XbzgZjc5VTB8IDLI4Y6BRJZtooyD6JQ/exec";
    let dadosAtuais = [], abaAtual = "";

    function verificarEmail() {
      const email = document.getElementById("email").value.trim();
      if (!email) return alert("Informe um e-mail.");

      fetch(`${URL_BASE}?email=${email}`)
        .then(res => res.text())
        .then(msg => {
          if (msg.includes("✅")) {
            document.getElementById("mensagem").innerText = "✅ Acesso autorizado.";
            document.getElementById("login").style.display = "none";
            document.getElementById("painel").style.display = "block";
            carregarTabela("TopMoedas1D");
          } else {
            document.getElementById("mensagem").innerText = msg;
          }
        });
    }

    function carregarTabela(aba) {
      abaAtual = aba;
      document.getElementById("tituloAba").innerText = `Tabela: ${aba}`;
      fetch(`${URL_BASE}?aba=${aba}`)
        .then(res => res.json())
        .then(dados => {
          dadosAtuais = dados;
          const headers = ["Ranking", "Nome", "Símbolo", "Slug", "RSI (1D)", "Variação 1D (%)", "Volume (24h)", "Market Cap", "Transações"];
          const cab = document.getElementById("cabecalho");
          const corpo = document.getElementById("dados");
          cab.innerHTML = "<tr>" + headers.map(h => `<th>${h}</th>`).join("") + "</tr>";
          corpo.innerHTML = "";

          dados.forEach(row => {
            const tr = document.createElement("tr");
            row.forEach((col, i) => {
              const td = document.createElement("td");
              td.innerHTML = (i === 3)
                ? `<a href="https://coinmarketcap.com/currencies/${col}/" target="_blank">${col}</a>`
                : col;

              // Coloração RSI
              if (aba.includes("OndaDeAlta") && i === 4 && !isNaN(col)) {
                if (col >= 72) td.style.background = "#00FF00";
                else if (col >= 58) td.style.background = "#C3F7C3";
              }

              // Coloração Variação
              if (i === 5 && !isNaN(col)) {
                if (col >= 30) td.style.background = "#006400";
                else if (col >= 20) td.style.background = "#228B22";
                else if (col >= 10) td.style.background = "#90EE90";
              }

              tr.appendChild(td);
            });
            corpo.appendChild(tr);
          });
        });
    }

    function exportarCSV() {
      if (dadosAtuais.length === 0) return alert("Nenhum dado para exportar.");
      let csv = dadosAtuais.map(row => row.join(",")).join("\n");
      let blob = new Blob([csv], { type: "text/csv;charset=utf-8;" });
      let link = document.createElement("a");
      link.href = URL.createObjectURL(blob);
      link.download = `${abaAtual}.csv`;
      link.click();
    }
  </script>
</body>
</html>
